//
//  shared-toolbar.tsx
//  core-cloud-web
//
//  Created by Fang Ling on 2025/7/25.
//
//  Licensed under the Apache License, Version 2.0 (the "License");
//  you may not use this file except in compliance with the License.
//  You may obtain a copy of the License at
//
//    http://www.apache.org/licenses/LICENSE-2.0
//
//  Unless required by applicable law or agreed to in writing, software
//  distributed under the License is distributed on an "AS IS" BASIS,
//  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//  See the License for the specific language governing permissions and
//  limitations under the License.
//

import useSharedToolbar from '@/view-models/shared-toolbar'
import Icon from './shared/toolbar/icon'
import Button from './shared/toolbar/button'
import UIImage from './ui-image'
import NoticePopover from './shared/toolbar/notice-popover'

export default function SharedToolbar({
  source,
  firstName,
  lastName,
  username,
  urls
}: {
  /*
   * When source is not 'app', we also need the overlay style class.
   */
  source: 'authenticator' | 'home' | 'app',
  firstName?: string,
  lastName?: string,
  username?: string,
  urls?: string[]
}) {
  const viewModel = useSharedToolbar({ })

  return (
    <>
      <header
        className={
          'top-0 height-11 min-h-11 pl-4 pr-1.5 flex sticky items-center ' +
            'select-none ' + (
              source === 'authenticator'
                ? (
                  'before:absolute before:backdrop-blur-[10px] z-3 ' +
                    'before:-z-1 border-b border-b-[rgba(251,251,253,.5)] ' +
                    'bg-[rgba(251,251,253,.5)] before:inset-0 ' +
                    'dark:border-b-[rgba(28,28,30,0.5)] ' +
                    'dark:bg-[rgba(28,28,30,0.5)]'
                )
                : source === 'home'
                  ? (
                    'dark:bg-[rgba(56,56,61,.6)] bg-[rgba(248,248,252,.4)] ' +
                      'z-3 backdrop-blur-[14px]'
                  )
                  : ''
            )
        }
      >
        {
          (() => {
            switch (source) {
              case 'authenticator': return (
                <Icon
                  urls={
                    process.env.NEXT_PUBLIC_AUTHENTICATOR_ICON_URLS?.split(',')
                  }
                />
              )
              case 'home': return (
                <Icon
                  urls={process.env.NEXT_PUBLIC_HOME_ICON_URLS?.split(',')}
                />
              )
            }
          })()
        }
        <div className="font-semibold text-[21px] text-systemBlack">
          <div
            dangerouslySetInnerHTML={{
              __html: process.env.NEXT_PUBLIC_TITLE ?? ''
            }}
          />
        </div>

        {
          source !== 'authenticator' && (
            <div className="ml-auto flex items-center">
              <Button
                onClick={(event) => {
                  viewModel.handleAdvancedDataProtectionButtonClick(event)
                }}
                isOpen={viewModel.radioMode === 1}
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="17"
                  height="19"
                  aria-hidden="true"
                  className="fill-current"
                >
                  <path
                    d={
                      'M3.323 1.282h10.364C13.616.445 13.126 0 12.25 ' +
                        '0H4.76c-.885 0-1.375.445-1.437 1.282ZM1.646 ' +
                        '3.825h13.708c-.125-.88-.573-1.388-1.562-1.388H' +
                        '3.219c-' +
                        '.99 0-1.438.509-1.573 1.388ZM2.74 19h11.52c1.782 0 ' +
                        '2.74-.964 2.74-2.766V7.916c0-1.791-.958-2.755-2.74-' +
                        '2.755H2.74C.948 5.16 0 6.125 0 7.916v8.318C0 ' +
                        '18.036.948 19 2.74 19Zm2.718-3.582v-3.306c0-.572.22-' +
                        '.88.657-.943v-.9c0-1.633.968-2.735 2.385-2.735 ' +
                        '1.417 0 2.385 1.102 2.385 2.734v.901c.438.064.657.' +
                        '37.657.943v3.306c0 ' +
                        '.668-.292.975-.896.975H6.354c-.604 ' +
                        '0-.896-.307-.896-.975Zm1.823-4.28h2.427v-.965c0-.89-' +
                        '.479-1.484-1.208-1.484-.74 0-1.219.594-1.219 ' +
                        '1.484v.964Z'
                    }
                  />
                </svg>
              </Button>
              <Button>
                <svg
                  className="fill-current"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 64 64"
                  height="22"
                  width="22"
                  aria-hidden="true"
                >
                  <path
                    d={
                      'M2.54982858,9.5141143 L7.18154287,9.5141143 ' +
                        'C8.96725716,9.5141143 9.60897144,8.87234287 ' +
                        '9.60897144,7.11457144 L9.60897144,2.48285715 ' +
                        'C9.60897144,0.697142858 8.96725716,0.0554285715 ' +
                        '7.18154287,0.0554285715 L2.54982858,0.0554285715 ' +
                        'C0.792000001,0.0554285715 0.150285715,0.697142858 ' +
                        '0.150285715,2.48285715 L0.150285715,7.11457144 ' +
                        'C0.150285715,8.87234287 0.792000001,9.5141143 ' +
                        '2.54982858,9.5141143 Z M19.2350857,9.5141143 ' +
                        'L23.8668,9.5141143 C25.6245715,9.5141143 ' +
                        '26.2663429,8.87234287 26.2663429,7.11457144 ' +
                        'L26.2663429,2.48285715 C26.2663429,0.697142858 ' +
                        '25.6245715,0.0554285715 23.8668,0.0554285715 ' +
                        'L19.2350857,0.0554285715 C17.4493715,0.0554285715 ' +
                        '16.8076572,0.697142858 16.8076572,2.48285715 ' +
                        'L16.8076572,7.11457144 C16.8076572,8.87234287 ' +
                        '17.4493715,9.5141143 19.2350857,9.5141143 Z ' +
                        'M35.8924572,9.5141143 L40.5241715,9.5141143 ' +
                        'C42.2819429,9.5141143 42.9237144,8.87234287 ' +
                        '42.9237144,7.11457144 L42.9237144,2.48285715 ' +
                        'C42.9237144,0.697142858 42.2819429,0.0554285715 ' +
                        '40.5241715,0.0554285715 L35.8924572,0.0554285715 ' +
                        'C34.1346286,0.0554285715 33.4929143,0.697142858 ' +
                        '33.4929143,2.48285715 L33.4929143,7.11457144 ' +
                        'C33.4929143,8.87234287 34.1346286,9.5141143 ' +
                        '35.8924572,9.5141143 Z M52.5496001,9.5141143 ' +
                        'L57.1816001,9.5141143 C58.9673144,9.5141143 ' +
                        '59.6090287,8.87234287 59.6090287,7.11457144 ' +
                        'L59.6090287,2.48285715 C59.6090287,0.697142858 ' +
                        '58.9673144,0.0554285715 57.1816001,0.0554285715 ' +
                        'L52.5496001,0.0554285715 C50.7918858,0.0554285715 ' +
                        '50.1502858,0.697142858 50.1502858,2.48285715 ' +
                        'L50.1502858,7.11457144 C50.1502858,8.87234287 ' +
                        '50.7918858,9.5141143 52.5496001,9.5141143 Z ' +
                        'M2.68931429,26.1714858 L7.32102858,26.1714858 ' +
                        'C9.10674287,26.1714858 9.74845716,25.5297143 ' +
                        '9.74845716,23.7719429 L9.74845716,19.1402286 ' +
                        'C9.74845716,17.3824 9.10674287,16.7406857 ' +
                        '7.32102858,16.7406857 L2.68931429,16.7406857 ' +
                        'C0.931542859,16.7406857 0.289771429,17.3824 ' +
                        '0.289771429,19.1402286 L0.289771429,23.7719429 ' +
                        'C0.289771429,25.5297143 0.931542859,26.1714858 ' +
                        '2.68931429,26.1714858 Z M19.3746286,26.1714858 ' +
                        'L24.0062858,26.1714858 C25.7641143,26.1714858 ' +
                        '26.4058286,25.5297143 26.4058286,23.7719429 ' +
                        'L26.4058286,19.1402286 C26.4058286,17.3824 ' +
                        '25.7641143,16.7406857 24.0062858,16.7406857 ' +
                        'L19.3746286,16.7406857 C17.5889143,16.7406857 ' +
                        '16.9471429,17.3824 16.9471429,19.1402286 ' +
                        'L16.9471429,23.7719429 C16.9471429,25.5297143 ' +
                        '17.5889143,26.1714858 19.3746286,26.1714858 Z ' +
                        'M36.0319429,26.1714858 L40.6636572,26.1714858 ' +
                        'C42.4214858,26.1714858 43.0632001,25.5297143 ' +
                        '43.0632001,23.7719429 L43.0632001,19.1402286 ' +
                        'C43.0632001,17.3824 42.4214858,16.7406857 ' +
                        '40.6636572,16.7406857 L36.0319429,16.7406857 ' +
                        'C34.2741715,16.7406857 33.6324001,17.3824 ' +
                        '33.6324001,19.1402286 L33.6324001,23.7719429 ' +
                        'C33.6324001,25.5297143 34.2741715,26.1714858 ' +
                        '36.0319429,26.1714858 Z M52.7170287,26.1714858 ' +
                        'L57.3210287,26.1714858 C59.106743,26.1714858 ' +
                        '59.7484572,25.5297143 59.7484572,23.7719429 ' +
                        'L59.7484572,19.1402286 C59.7484572,17.3824 ' +
                        '59.106743,16.7406857 57.3210287,16.7406857 ' +
                        'L52.7170287,16.7406857 C50.9313144,16.7406857 ' +
                        '50.2896001,17.3824 50.2896001,19.1402286 ' +
                        'L50.2896001,23.7719429 C50.2896001,25.5297143 ' +
                        '50.9313144,26.1714858 52.7170287,26.1714858 Z ' +
                        'M2.68931429,42.8567372 L7.32102858,42.8567372 ' +
                        'C9.10674287,42.8567372 9.74845716,42.2150001 ' +
                        '9.74845716,40.4292858 L9.74845716,35.8254858 ' +
                        'C9.74845716,34.0397715 9.10674287,33.3980572 ' +
                        '7.32102858,33.3980572 L2.68931429,33.3980572 ' +
                        'C0.931542859,33.3980572 0.289771429,34.0397715 ' +
                        '0.289771429,35.8254858 L0.289771429,40.4292858 ' +
                        'C0.289771429,42.2150001 0.931542859,42.8567372 ' +
                        '2.68931429,42.8567372 Z M19.3746286,42.8567372 ' +
                        'L24.0062858,42.8567372 C25.7641143,42.8567372 ' +
                        '26.4058286,42.2150001 26.4058286,40.4292858 ' +
                        'L26.4058286,35.8254858 C26.4058286,34.0397715 ' +
                        '25.7641143,33.3980572 24.0062858,33.3980572 ' +
                        'L19.3746286,33.3980572 C17.5889143,33.3980572 ' +
                        '16.9471429,34.0397715 16.9471429,35.8254858 ' +
                        'L16.9471429,40.4292858 C16.9471429,42.2150001 ' +
                        '17.5889143,42.8567372 19.3746286,42.8567372 Z ' +
                        'M36.0319429,42.8567372 L40.6636572,42.8567372 ' +
                        'C42.4214858,42.8567372 43.0632001,42.2150001 ' +
                        '43.0632001,40.4292858 L43.0632001,35.8254858 ' +
                        'C43.0632001,34.0397715 42.4214858,33.3980572 ' +
                        '40.6636572,33.3980572 L36.0319429,33.3980572 ' +
                        'C34.2741715,33.3980572 33.6324001,34.0397715 ' +
                        '33.6324001,35.8254858 L33.6324001,40.4292858 ' +
                        'C33.6324001,42.2150001 34.2741715,42.8567372 ' +
                        '36.0319429,42.8567372 Z M52.7170287,42.8567372 ' +
                        'L57.3210287,42.8567372 C59.106743,42.8567372 ' +
                        '59.7484572,42.2150001 59.7484572,40.4292858 ' +
                        'L59.7484572,35.8254858 C59.7484572,34.0397715 ' +
                        '59.106743,33.3980572 57.3210287,33.3980572 ' +
                        'L52.7170287,33.3980572 C50.9313144,33.3980572 ' +
                        '50.2896001,34.0397715 50.2896001,35.8254858 ' +
                        'L50.2896001,40.4292858 C50.2896001,42.2150001 ' +
                        '50.9313144,42.8567372 52.7170287,42.8567372 Z'
                    }
                    transform="translate(2 10.571)"
                  >
                  </path>
                </svg>
              </Button>
              <Button>
                {
                  (urls && urls.length > 0)
                    ? (
                      <UIImage
                        urls={urls}
                        className="size-7 rounded-full group-active:opacity-60"
                      />
                    )
                    : (
                      <svg
                        className="fill-current"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 64 64"
                        width="28"
                        height="28"
                      >
                        <path
                          d={
                            'M29.9475268,59.5867724 C46.1333288,59.5867724 ' +
                              '59.534715,46.15661 59.534715,29.9998218 ' +
                              'C59.534715,13.8140198 46.1043387,0.412871288 ' +
                              '29.9185367,0.412871288 C13.7617248,' +
                              '0.412871288 ' +
                              '0.36059406,13.8140198 0.36059406,29.9998218 ' +
                              'C0.36059406,46.15661 13.7907743,59.5867724 ' +
                              '29.9475268,59.5867724 Z M29.9475268,' +
                              '39.8621585 ' +
                              'C21.2165169,39.8621585 14.5159426,42.9948714 ' +
                              '11.5572297,46.4756852 C7.67029902,42.0956436 ' +
                              '5.32073466,36.3523367 5.32073466,29.9998218 ' +
                              'C5.32073466,16.3085941 16.2273089,5.34403961 ' +
                              '29.9185367,5.34403961 C43.6097644,5.34403961 ' +
                              '54.5743189,16.3085941 54.6039513,29.9998218 ' +
                              'C54.6325367,36.3523367 52.253804,42.1246337 ' +
                              '48.3378832,46.4756852 C45.4081605,42.9948714 ' +
                              '38.6785961,39.8621585 29.9475268,39.8621585 Z ' +
                              'M29.9475268,34.9309902 C35.5458832,34.9889704 ' +
                              '39.8968931,30.2318614 39.8968931,23.9954258 ' +
                              'C39.8968931,18.1360396 35.5168337,13.291901 ' +
                              '29.9475268,13.291901 C24.3782198,13.291901 ' +
                              '19.9691703,18.1360396 19.9979358,23.9954258 ' +
                              'C20.0272099,30.2318614 24.3782198,34.8729506 ' +
                              '29.9475268,34.9309902 Z'
                          }
                          transform="translate(2 2)"
                        >
                        </path>
                      </svg>
                    )
                }
              </Button>
            </div>
          )
        }
      </header>

      {
        viewModel.radioMode === 1 && (
          <NoticePopover
            onClose={() => viewModel.handleModalClose()}
            right={viewModel.modalRight}
          >
            <div
              className="pt-1.25 min-w-15.75 md:min-w-19.75 flex justify-center"
            >
              <svg
                viewBox="0 0 100.34765625 106.2001953125"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                className="w-5.75 md:w-7.25 fill-systemBlue"
                aria-hidden="true"
                width="29"
                height="31"
              >
                <g transform="matrix(1 0 0 1 -12.451142578124973 88.330078125)">
                  <path
                    d={
                      'M31.8359-82.0312L93.457-82.0312C93.1641-86.1816 ' +
                        '90.8203-88.3301 86.2793-88.3301L38.9648-88.3301C34.' +
                        '4727-88.3301 32.1289-86.1816 31.8359-82.0312ZM21.' +
                        '7773-68.5059L103.516-68.5059C102.783-72.9492 100.' +
                        '684-75.3906 95.8008-75.3906L29.4922-75.3906C24.' +
                        '6094-75.3906 22.5098-72.9492 ' +
                        '21.7773-68.5059ZM27.2949 ' +
                        '17.8223L97.9492 17.8223C107.764 17.8223 112.793 ' +
                        '12.8418 112.793 ' +
                        '3.125L112.793-45.9961C112.793-55.7129 ' +
                        '107.764-60.6445 97.9492-60.6445L27.2949-60.6445C17.' +
                        '3828-60.6445 12.4512-55.7129 ' +
                        '12.4512-45.9961L12.4512 ' +
                        '3.125C12.4512 12.8418 17.3828 17.8223 27.2949 ' +
                        '17.8223ZM44.4824-1.51367L44.4824-21.5332C44.4824-25.' +
                        '0977 45.9473-26.8555 ' +
                        '48.877-27.0508L48.877-32.959C48.' +
                        '877-42.2363 54.4434-48.4863 62.6465-48.4863C70.8496-' +
                        '48.4863 76.416-42.2363 76.416-32.959L76.416-27.' +
                        '0508C79.3457-26.8555 80.8105-25.0977 80.8105-21.' +
                        '5332L80.8105-1.51367C80.8105 2.24609 ' +
                        '79.1504 4.00391 ' +
                        '75.6836 4.00391L49.6094 4.00391C46.1426 4.00391 ' +
                        '44.4824 2.24609 44.4824-1.51367ZM54.1504-27.0996L71.' +
                        '1426-27.0996L71.1426-33.5449C71.1426-39.4531 ' +
                        '67.7246-43.4082 62.6465-43.4082C57.5684-43.4082 ' +
                        '54.1504-39.4531 54.1504-33.5449Z'
                    }
                  />
                </g>
              </svg>
            </div>
            <div>
              <p
                className={
                  'text-base font-semibold leading-5.25 text-labelPrimary'
                }
              >
              {'Advanced Data Protection is On.'}
            </p>
            <p className="text-base leading-5.25">
              <span
                dangerouslySetInnerHTML={{
                  __html: process.env.NEXT_PUBLIC_TITLE ?? ''
                }}
              />
              {
                ' doesn\'t have access to display some of your data, ' +
                  'including photos, videos, songs, and files. Select an app ' +
                  'to allow access using your master password.'
              }
            </p>
            </div>
          </NoticePopover>
        )
      }
    </>
  )
}
